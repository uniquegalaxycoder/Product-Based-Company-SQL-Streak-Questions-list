"""
  Q.Compute rolling 7-day metrics.
"""
  
CREATE TABLE daily_metrics (
    metric_date DATE PRIMARY KEY,
    daily_value DECIMAL(10, 2)
);

INSERT INTO daily_metrics (metric_date, daily_value) VALUES 
('2026-01-01', 120.00), ('2026-01-02', 150.00), ('2026-01-03', 100.00),
('2026-01-04', 90.00),  ('2026-01-05', 200.00), ('2026-01-06', 250.00),
('2026-01-07', 300.00), ('2026-01-08', 150.00), ('2026-01-09', 180.00),
('2026-01-10', 220.00), ('2026-01-11', 210.00), ('2026-01-12', 230.00),
('2026-01-13', 250.00), ('2026-01-14', 280.00);

SELECT * FROM daily_metrics ;

WITH CTE1 AS (
    SELECT 
      metric_date,
      daily_value,
      ROUND(AVG(daily_value)OVER(ORDER BY metric_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW )) AS ROLLING_7DAYS
    FROM daily_metrics
)

SELECT * FROM CTE1 ;

"""
  Output =>
  +-------------+-------------+---------------+
  | metric_date | daily_value | ROLLING_7DAYS |
  +-------------+-------------+---------------+
  | 2026-01-01  |      120.00 |           120 |
  | 2026-01-02  |      150.00 |           135 |
  | 2026-01-03  |      100.00 |           123 |
  | 2026-01-04  |       90.00 |           115 |
  | 2026-01-05  |      200.00 |           132 |
  | 2026-01-06  |      250.00 |           152 |
  | 2026-01-07  |      300.00 |           173 |
  | 2026-01-08  |      150.00 |           177 |
  | 2026-01-09  |      180.00 |           181 |
  | 2026-01-10  |      220.00 |           199 |
  | 2026-01-11  |      210.00 |           216 |
  | 2026-01-12  |      230.00 |           220 |
  | 2026-01-13  |      250.00 |           220 |
  | 2026-01-14  |      280.00 |           217 |
  +-------------+-------------+---------------+
  
  """
